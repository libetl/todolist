<html>
    <head>
        <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
        <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
        <script defer src="https://code.getmdl.io/1.3.0/material.js"></script>
        <title>Todo list</title>
    </head>
    <body>
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
        <header class="mdl-layout__header">
            <div class="mdl-layout__header-row">
                <span class="mdl-layout-title">Todo list sandbox</span>
                <div class="mdl-layout-spacer"></div>
                <nav class="mdl-navigation mdl-layout--large-screen-only">
                </nav>
            </div>
        </header>
        <main class="mdl-layout__content" style="margin: 10%;">
            <h2>Manage your tasks</h2>
            <form action="#">
                <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                    <input class="mdl-textfield__input" type="text" id="text">
                    <label class="mdl-textfield__label" for="text">Task name</label>
                </div>
                <button id="add" class="mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab mdl-button--colored mdl-js-ripple-effect">
                    <i class="material-icons">add</i>
                </button>
            </form>
            <table id="table" class="mdl-data-table mdl-js-data-table mdl-data-table--selectable mdl-shadow--2dp" style="float:left">
                <thead>
                <tr>
                    <th class="mdl-data-table__cell--non-numeric">Task name</th>
                    <th>Created on</th>
                </tr>
                </thead>
                <tbody id="list">
                </tbody>
            </table>
            <button id="done" class="mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab mdl-button--colored mdl-js-ripple-effect">
                <i class="material-icons">done</i>
            </button>
            <button id="delete" class="mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab mdl-button--colored mdl-js-ripple-effect">
                <i class="material-icons">delete</i>
            </button>
        </main>
    </div>

    <script src="src/repository.js"></script>
    <script src="src/tasks.js"></script>
    <script src="src/render.js"></script>
    <script>

        const getSelectedNodes = () =>
            [...document.querySelectorAll('tr.is-selected')].map(node =>
                [...node.parentNode.childNodes].filter(node =>
                    node.nodeName !== '#text').indexOf(node))

        document.querySelector('#add').onclick = () => {
            tasks.add({message: document.querySelector('#text').value})
            repository.saveTasks(tasks.read())
            reRender(tasks.read())
        }

        document.querySelector('#done').onclick = () => {
            tasks.toggleDone(getSelectedNodes())
            repository.saveTasks(tasks.read())
            reRender(tasks.read())
        }

        document.querySelector('#delete').onclick = () => {
            tasks.remove(getSelectedNodes())
            repository.saveTasks(tasks.read())
            reRender(tasks.read())
        }

        reRender(tasks.read())
    </script>
    </body>
</html>